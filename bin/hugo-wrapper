#!/bin/bash -e

_mkpost() {
    # create post
    local post_path="$1"
    local img_dir_path="$(echo ${post_path} | awk -F '\.md' '{ print $1 }' | awk -F 'content/post/' '{ print $2 }')"
    local img_dir_fullpath="static/img/${img_dir_path}"

    cat <<EOF >${post_path}
+++
title = ""
date = "$(date '+%FT00:00:00+09:00')"
draft = "false"
author = "${HUGO_AUTHOR}"
cover = "${img_dir_path}/cover.jpg"
description = ""
tags = []
+++

EOF

    # make image directory
    mkdir -p ${img_dir_fullpath}
    touch ${img_dir_fullpath}/.keep
}

case "$1" in
    mkpost )
        _mkpost "$2"
        ;;
    * )
        command hugo $@;;
esac
